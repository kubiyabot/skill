# Implementation Plan: Hybrid Bridge Generator

## Overview

Implement `skill claude generate` command that generates Claude Agent Skills with dual-mode execution (MCP + Scripts).

## Goal

**100% Claude Agent Skills compliance** with Skill Engine's context engineering capabilities.

```
Output:
~/.claude/skills/kubernetes/
├── SKILL.md              # Dual-mode instructions
├── TOOLS.md              # Parameter reference
└── scripts/
    ├── get.sh            # skill run kubernetes get "$@"
    ├── describe.sh
    └── ...
```

---

## Phases

### Phase 1: Core Infrastructure (3-4 days)

#### 1.1 Create `claude_bridge` Module

```
crates/skill-cli/src/
├── claude_bridge/
│   ├── mod.rs            # Module exports
│   ├── types.rs          # Data structures
│   ├── loader.rs         # Load skills from manifest
│   ├── transformer.rs    # Transform to Claude format
│   ├── validator.rs      # Validate names/descriptions
│   ├── renderer.rs       # Render SKILL.md/TOOLS.md
│   └── script_gen.rs     # Generate scripts
```

**Tasks:**
- [ ] Create module structure
- [ ] Define `ClaudeSkill`, `ClaudeTool`, `GenerateOptions` types
- [ ] Implement `Loader` - parse manifest, load tool definitions
- [ ] Implement `Validator` - name (64 chars, lowercase), description (1024 chars)
- [ ] Implement `Transformer` - normalize data, categorize tools

#### 1.2 Add CLI Command

**File:** `crates/skill-cli/src/commands/claude.rs`

**Tasks:**
- [ ] Add `generate` subcommand to existing `ClaudeCommands` enum
- [ ] Add options: `--output`, `--skill`, `--project`, `--force`, `--dry-run`, `--no-scripts`
- [ ] Wire up to `claude_bridge::generate()`

---

### Phase 2: Renderer & Templates (2-3 days)

#### 2.1 Template Engine Setup

**Tasks:**
- [ ] Add `handlebars` dependency
- [ ] Create template helpers (titlecase, etc.)
- [ ] Create `templates/` directory with `.hbs` files

#### 2.2 SKILL.md Template

**File:** `claude_bridge/templates/skill_md.hbs`

**Features:**
- [ ] YAML frontmatter (name, description)
- [ ] When to Use section
- [ ] Dual-mode execution (MCP + Scripts)
- [ ] Quick reference table
- [ ] Tool categories with examples
- [ ] Context engineering section
- [ ] Available scripts list

#### 2.3 TOOLS.md Template

**File:** `claude_bridge/templates/tools_md.hbs`

**Features:**
- [ ] Parameter tables per tool
- [ ] Examples for each tool
- [ ] Type information

---

### Phase 3: Script Generator (1-2 days)

#### 3.1 Script Generator

**File:** `claude_bridge/script_gen.rs`

**Tasks:**
- [ ] Generate `#!/bin/bash` header
- [ ] Add tool description comment
- [ ] Add usage examples
- [ ] Add parameter documentation
- [ ] Generate `exec skill run <skill> <tool> "$@"`
- [ ] Set executable permissions (chmod +x)

#### 3.2 Script Structure

```bash
#!/bin/bash
# kubernetes/scripts/get.sh - Generated by Skill Engine
#
# Get Kubernetes resources
#
# Usage:
#   ./get.sh resource=pods namespace=default
#
# Parameters:
#   resource   - Resource type (required)
#   namespace  - Kubernetes namespace

set -euo pipefail
exec skill run kubernetes get "$@"
```

---

### Phase 4: Integration & Testing (2-3 days)

#### 4.1 Integration

**Tasks:**
- [ ] Wire all components together in main generate function
- [ ] Handle `--dry-run` mode
- [ ] Handle `--force` overwrite
- [ ] Handle `--no-scripts` mode
- [ ] Pretty output with colors (reuse from claude.rs)

#### 4.2 Testing

**Unit Tests:**
- [ ] `validator::validate_name()` - edge cases
- [ ] `validator::validate_description()` - truncation
- [ ] `transformer::categorize_tools()` - tool categorization
- [ ] `script_gen::generate_script()` - script format

**Integration Tests:**
- [ ] Generate kubernetes skill
- [ ] Verify SKILL.md structure
- [ ] Verify TOOLS.md content
- [ ] Verify scripts are executable
- [ ] Verify scripts run correctly

**E2E Test:**
```bash
#!/bin/bash
skill claude generate --skill kubernetes --output /tmp/test
test -f /tmp/test/kubernetes/SKILL.md
test -f /tmp/test/kubernetes/TOOLS.md
test -x /tmp/test/kubernetes/scripts/get.sh
/tmp/test/kubernetes/scripts/get.sh --help
```

---

## File Changes Summary

### New Files

| File | Description |
|------|-------------|
| `crates/skill-cli/src/claude_bridge/mod.rs` | Module exports |
| `crates/skill-cli/src/claude_bridge/types.rs` | Data structures |
| `crates/skill-cli/src/claude_bridge/loader.rs` | Skill loader |
| `crates/skill-cli/src/claude_bridge/transformer.rs` | Data transformer |
| `crates/skill-cli/src/claude_bridge/validator.rs` | Validation logic |
| `crates/skill-cli/src/claude_bridge/renderer.rs` | Template renderer |
| `crates/skill-cli/src/claude_bridge/script_gen.rs` | Script generator |
| `crates/skill-cli/src/claude_bridge/templates/skill_md.hbs` | SKILL.md template |
| `crates/skill-cli/src/claude_bridge/templates/tools_md.hbs` | TOOLS.md template |

### Modified Files

| File | Changes |
|------|---------|
| `crates/skill-cli/src/commands/mod.rs` | Add `claude_bridge` module |
| `crates/skill-cli/src/commands/claude.rs` | Add `generate()` function |
| `crates/skill-cli/src/main.rs` | Add `Generate` subcommand |
| `crates/skill-cli/Cargo.toml` | Add `handlebars` dependency |

---

## Dependencies

```toml
# Add to Cargo.toml
handlebars = "5.1"
```

---

## Timeline

| Phase | Duration | Deliverable |
|-------|----------|-------------|
| Phase 1 | 3-4 days | Core module structure |
| Phase 2 | 2-3 days | Templates & renderer |
| Phase 3 | 1-2 days | Script generator |
| Phase 4 | 2-3 days | Integration & tests |
| **Total** | **8-12 days** | Full implementation |

---

## Success Criteria

1. **`skill claude generate`** produces valid Claude Agent Skills
2. **SKILL.md** has correct YAML frontmatter (validated)
3. **Scripts** are executable and work correctly
4. **Dual-mode** instructions in SKILL.md
5. **100% gap coverage** from gap analysis

---

## Verification

```bash
# Generate skills
skill claude generate

# Verify structure
ls ~/.claude/skills/kubernetes/
# SKILL.md  TOOLS.md  scripts/

# Verify SKILL.md frontmatter
head -5 ~/.claude/skills/kubernetes/SKILL.md
# ---
# name: kubernetes
# description: ...
# ---

# Verify scripts work
~/.claude/skills/kubernetes/scripts/get.sh resource=pods
# (output from kubectl get pods)

# Verify in Claude Code
claude
> "Show me pods in kube-system"
# Claude reads SKILL.md, uses MCP or scripts
```

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Template complexity | Start with minimal template, iterate |
| Script compatibility (Windows) | Initially target Unix, add .ps1 later |
| Tool loading failures | Graceful degradation, skip failed skills |
| Large skill count | Add `--skill` filter, parallel generation |
